# ============================================================================
# LUFFY OBSERVABILITY PLATFORM - ENVIRONMENT CONFIGURATION
# ============================================================================
# This is the SINGLE SOURCE OF TRUTH for all configuration.
# Copy this file to .env and update values for your environment.
# ============================================================================

# ============================================================================
# ENVIRONMENT
# ============================================================================
ENVIRONMENT=development  # development, staging, production

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================

# PostgreSQL - Main Database
POSTGRES_USER=luffy_user
POSTGRES_PASSWORD=luffy_password
POSTGRES_DB=observability
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}
DATABASE_POOL_SIZE=20
DATABASE_MAX_OVERFLOW=40

# ============================================================================
# REDIS CONFIGURATION
# ============================================================================
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=
REDIS_URL=redis://${REDIS_HOST}:${REDIS_PORT}/${REDIS_DB}
REDIS_CACHE_TTL=3600

# ============================================================================
# VECTOR DATABASE (Qdrant)
# ============================================================================
VECTOR_DB_TYPE=qdrant
QDRANT_HOST=qdrant
QDRANT_PORT=6333
QDRANT_API_KEY=
EMBEDDING_MODEL=sentence-transformers/all-MiniLM-L6-v2
EMBEDDING_DIMENSION=384

# ============================================================================
# OPENSEARCH / ELASTICSEARCH
# ============================================================================
LOG_SOURCE=opensearch
OPENSEARCH_HOST=opensearch
OPENSEARCH_PORT=9200
OPENSEARCH_USER=admin
OPENSEARCH_PASSWORD=admin
OPENSEARCH_USE_SSL=false
OPENSEARCH_VERIFY_CERTS=false
ELASTICSEARCH_URL=http://${OPENSEARCH_HOST}:${OPENSEARCH_PORT}
ELASTICSEARCH_INDEX=logs-*
ELASTICSEARCH_USERNAME=${OPENSEARCH_USER}
ELASTICSEARCH_PASSWORD=${OPENSEARCH_PASSWORD}

# ============================================================================
# CLICKHOUSE (Optional - Time Series Database)
# ============================================================================
CLICKHOUSE_HOST=clickhouse
CLICKHOUSE_PORT=8123
CLICKHOUSE_DATABASE=logs
CLICKHOUSE_URL=http://${CLICKHOUSE_HOST}:${CLICKHOUSE_PORT}

# ============================================================================
# LLM CONFIGURATION
# ============================================================================
LLM_PROVIDER=openai
OPENAI_API_KEY=sk-your-openai-api-key-here
OPENAI_MODEL=gpt-4-turbo-preview
LLM_MODEL=${OPENAI_MODEL}
LLM_TEMPERATURE=0.2
LLM_MAX_TOKENS=2000

# Anthropic (Alternative)
ANTHROPIC_API_KEY=

# ============================================================================
# CODE REPOSITORY
# ============================================================================
CODE_INDEXING_MODE=api  # api or local
GIT_REPO_PATH=/app/data/repos/your-repo
GIT_BRANCH=main
CODE_VERSION=latest

# GitHub/GitLab API (for api mode)
GITHUB_TOKEN=
GITLAB_TOKEN=

# ============================================================================
# API SERVER CONFIGURATION
# ============================================================================
API_HOST=0.0.0.0
API_PORT=8000
API_WORKERS=4
API_RELOAD=false
CORS_ORIGINS=http://localhost:3000,http://localhost:8000

# ============================================================================
# FRONTEND CONFIGURATION
# ============================================================================
FRONTEND_PORT=3000
REACT_APP_API_URL=http://localhost:${API_PORT}

# ============================================================================
# FLUENT BIT CONFIGURATION
# ============================================================================
FLUENT_BIT_API_TOKEN=your-secure-token-here
FLUENT_BIT_RATE_LIMIT=10000
FLUENT_BIT_BATCH_SIZE_LIMIT=1000
FLUENT_BIT_DEDUP_WINDOW_SECONDS=600

# ============================================================================
# LOG PROCESSING
# ============================================================================
LOG_FETCH_INTERVAL=30m
BATCH_SIZE=1000
MAX_WORKERS=4
CLUSTERING_THRESHOLD=0.85
MIN_CLUSTER_SIZE=2
PROCESSING_LOG_LEVELS=ERROR,CRITICAL,FATAL

# ============================================================================
# TASK SCHEDULING (Celery)
# ============================================================================
CELERY_BROKER_URL=${REDIS_URL}
CELERY_RESULT_BACKEND=${REDIS_URL}
CELERY_TASK_SERIALIZER=json
CELERY_RESULT_SERIALIZER=json
CELERY_ACCEPT_CONTENT=json
CELERY_TIMEZONE=UTC
CELERY_ENABLE_UTC=true

# Task Intervals
TASK_FETCH_LOGS_INTERVAL=30m
TASK_GENERATE_RCA_INTERVAL=15m
TASK_INDEX_CODE_INTERVAL=24h
TASK_CLEANUP_OLD_DATA_INTERVAL=7d

# ============================================================================
# OBJECT STORAGE (Optional)
# ============================================================================
STORAGE_BACKEND=local  # s3, gcs, or local
LOCAL_STORAGE_PATH=/app/data/storage

# AWS S3
S3_BUCKET=luffy-logs
S3_REGION=us-east-1
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=

# Google Cloud Storage
GCS_BUCKET=luffy-logs
GCS_PROJECT_ID=
GOOGLE_APPLICATION_CREDENTIALS=/path/to/credentials.json

# ============================================================================
# MONITORING & LOGGING
# ============================================================================
LOG_LEVEL=INFO
ENABLE_METRICS=true
METRICS_PORT=9090

# ============================================================================
# SECURITY
# ============================================================================
SECRET_KEY=your-secret-key-change-in-production
JWT_SECRET_KEY=your-jwt-secret-key-change-in-production
JWT_ALGORITHM=HS256
JWT_EXPIRATION_HOURS=24

# ============================================================================
# DOCKER COMPOSE OVERRIDES
# ============================================================================
# These are used by docker-compose.yml to expose ports

# Exposed Ports
POSTGRES_EXTERNAL_PORT=5432
REDIS_EXTERNAL_PORT=6379
QDRANT_EXTERNAL_PORT=6333
OPENSEARCH_EXTERNAL_PORT=9200
OPENSEARCH_DASHBOARDS_PORT=5601
CLICKHOUSE_HTTP_PORT=8123
CLICKHOUSE_NATIVE_PORT=9000
API_EXTERNAL_PORT=8000
FRONTEND_EXTERNAL_PORT=3000
FLUENT_BIT_HTTP_PORT=2020

# Resource Limits (for production)
POSTGRES_MEMORY_LIMIT=2g
REDIS_MEMORY_LIMIT=1g
QDRANT_MEMORY_LIMIT=2g
OPENSEARCH_MEMORY_LIMIT=4g
API_MEMORY_LIMIT=2g
WORKER_MEMORY_LIMIT=2g
FRONTEND_MEMORY_LIMIT=512m

# ============================================================================
# CLOUD PROVIDERS (Optional)
# ============================================================================

# AWS CloudWatch
AWS_REGION=us-east-1
CLOUDWATCH_LOG_GROUP=/aws/ecs/production

# GCP Logging
GCP_PROJECT_ID=my-project

# ============================================================================
# FEATURE FLAGS
# ============================================================================
ENABLE_CODE_INDEXING=true
ENABLE_RCA_GENERATION=true
ENABLE_OPENSEARCH=true
ENABLE_CLICKHOUSE=false
ENABLE_FLUENT_BIT=true
ENABLE_OPENSEARCH_DASHBOARDS=false

# ============================================================================
# DEVELOPMENT SETTINGS
# ============================================================================
# Only used in development mode
DEBUG=false
RELOAD_ON_CHANGE=false
ENABLE_PROFILING=false

# ============================================================================
# PRODUCTION SETTINGS
# ============================================================================
# Uncomment and configure for production deployment

# SSL/TLS
# ENABLE_SSL=true
# SSL_CERT_PATH=/path/to/cert.pem
# SSL_KEY_PATH=/path/to/key.pem

# Rate Limiting
# RATE_LIMIT_PER_MINUTE=1000
# RATE_LIMIT_PER_HOUR=10000

# Backup
# BACKUP_ENABLED=true
# BACKUP_SCHEDULE=0 2 * * *
# BACKUP_RETENTION_DAYS=30

# Alerting
# SLACK_WEBHOOK_URL=
# EMAIL_SMTP_HOST=
# EMAIL_SMTP_PORT=587
# EMAIL_FROM=alerts@luffy.io
# EMAIL_TO=team@yourcompany.com

# ============================================================================
# NOTES
# ============================================================================
# 1. Copy this file to .env: cp .env.example .env
# 2. Update all values marked with "your-" or "change-in-production"
# 3. Never commit .env to version control
# 4. Use strong passwords and tokens in production
# 5. Enable SSL/TLS in production
# 6. Configure backups and monitoring
# ============================================================================
